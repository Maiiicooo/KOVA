<!DOCTYPE html>
<html lang="nl">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Wind View</title>
  <!-- PWA manifest -->
  <link rel="manifest" href="/KOVA/manifest.json">
  <meta name="theme-color" content="#000000">

  <!-- Apple-web-app -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="/KOVA/images/appicon.JPG">

  <!-- MapTiler SDK + Weather-plugin -->
  <script src="https://cdn.maptiler.com/maptiler-sdk-js/v3.2.0/maptiler-sdk.umd.min.js"></script>
  <link href="https://cdn.maptiler.com/maptiler-sdk-js/v3.2.0/maptiler-sdk.css" rel="stylesheet" />
  <script src="https://cdn.maptiler.com/maptiler-weather/v3.0.1/maptiler-weather.umd.min.js"></script>

  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
    }

    #map {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 100%;
      background: #444952;
    }

    /* Navbar */
    .navbar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 60px;
      display: flex;
      align-items: flex-start;
      padding: 0 20px;
      background: rgba(0, 0, 0, 0);
      z-index: 10;
    }

    .navbar-left {
      display: flex;
      align-items: flex-start;
      gap: 30px;
    }

    .logo-time {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      margin-top: 10px;
    }

    .navbar-logo {
      width: 140px;
    }

    #time-info {
      margin-top: 4px;
      font-size: 12px;
      color: white;
      text-shadow: 0 0 4px black;
      line-height: 1;
    }

    .navbar-items {
      display: flex;
      gap: 20px;
    }

    .navbar-items a {
      color: white;
      text-decoration: none;
      font-weight: 500;
      font-size: 16px;
      line-height: 60px;
      cursor: pointer;
      transition: color .3s;
    }

    .navbar-items a:hover {
      color: #8b7108;
    }

    /* Windsnelheid-overlay */
    #variable-name {
      z-index: 11;
      position: fixed;
      top: 180px;
      left: 10px;
      font-size: 16px;
      font-weight: 600;
      color: white;
      text-shadow: 0 0 6px black;
      background: transparent;
      padding: 4px 8px;
      border-radius: 4px;
    }

    #pointer-data {
      z-index: 11;
      position: fixed;
      top: 200px;
      left: 10px;
      font-size: 16px;
      font-weight: 700;
      color: white;
      text-shadow: 0 0 8px black;
      background: transparent;
      padding: 4px 8px;
      border-radius: 4px;
    }

    /* hide MapTiler watermark */
    .maplibregl-ctrl-bottom-left,
    .maplibregl-ctrl-logo,
    .maplibregl-ctrl-attrib,
    .maptiler-attribution {
      display: none !important;
      visibility: hidden !important;
      opacity: 0 !important;
    }
  </style>
</head>

<body>
  <!-- Navbar -->
  <div class="navbar">
    <div class="navbar-left">
      <div class="logo-time">
        <img src="images/testje.png" class="navbar-logo" id="mainLogo" alt="Logo">
        <div id="time-info"><span id="time-text">Laden…</span></div>
      </div>
      <div class="navbar-items">
        <a href="#" id="fourHButton">▶︎</a>
        <a href="#" id="ctButton">◼</a>
        <a href="index.html" id="backButton">NV</a>
        <a href="about.html" id="aboutButton">ABOUT</a>
      </div>
    </div>
  </div>


  <!-- Overlay voor Windsnelheid -->
  <div id="variable-name">WIND</div>
  <div id="pointer-data"></div>

  <!-- Kaartcontainer -->
  <div id="map"></div>

  <script>
    maptilersdk.config.apiKey = '7TBqy4hTdFfQeIq7oXKj';

    const map = new maptilersdk.Map({
      container: 'map',
      style: 'https://api.maptiler.com/maps/dataviz-dark/style.json?key=7TBqy4hTdFfQeIq7oXKj',
      zoom: 7.5,
      center: [4.5, 50.85],
      projection: "mercator",
      minZoom: 5,
      maxZoom: 10,
      navigationControl: false,
      projectionControl: false,
      geolocateControl: false
    });


    // GEOLOCATIE
    if (navigator.geolocation) {
      const userMarkerEl = document.createElement("img");
      userMarkerEl.src = "images/playericon.png";
      userMarkerEl.style.width = "28px";
      userMarkerEl.style.height = "28px";
      userMarkerEl.style.transform = "translate(-50%, -50%)";
      userMarkerEl.classList.add("marker-clickable");


      const userPopupHTML = `
          <div style="width:150px; text-align:center; font-family:sans-serif;">
            <img src="images/playeravatar.png" style="width:100%; height:auto; border-radius:6px; margin-bottom:6px;">
            <strong>This is you</strong><br>
          </div>
        `;
      const userPopup = new maptilersdk.Popup({ offset: 25 }).setHTML(userPopupHTML);

      const userMarker = new maptilersdk.Marker({ element: userMarkerEl })
        .setLngLat([0, 0])
        .setPopup(userPopup)
        .addTo(map);

      navigator.geolocation.getCurrentPosition(
        (position) => {
          const lng = position.coords.longitude;
          const lat = position.coords.latitude;
          userMarker.setLngLat([lng, lat]);
          map.setCenter([lng, lat]);
        },
        (err) => console.warn("Locatie fout:", err.message),
        { enableHighAccuracy: true }
      );
    }

    const windLayer = new maptilerweather.WindLayer({ opacity: 0.5 });
    let liveTimer;

    function tickLive() {
      const now = new Date();
      document.getElementById('time-text').innerText = now.toLocaleString('nl-BE', {
        day: '2-digit', month: '2-digit', year: 'numeric',
        hour: '2-digit', minute: '2-digit', second: '2-digit'
      });
      windLayer.setAnimationTime(Math.floor(now.getTime() / 1000));
    }

    function startLive() {
      windLayer.animateByFactor(0);
      clearInterval(liveTimer);
      tickLive();
      liveTimer = setInterval(tickLive, 1000);
    }

    map.on('load', () => {
      map.addLayer(windLayer);
      startLive();
    });

    // Windsnelheid bij muispositie
    function updatePointerValue(lngLat) {
      if (!lngLat) return;
      const value = windLayer.pickAt(lngLat.lng, lngLat.lat);
      document.getElementById('pointer-data').innerText = value ? `${value.speedMetersPerSecond.toFixed(1)} m/s` : '';
    }

    map.on('mousemove', e => updatePointerValue(e.lngLat));
    map.on('mouseout', () => document.getElementById('pointer-data').innerText = '');

    // Logo hover
    const logo = document.getElementById('mainLogo');
    logo.addEventListener('mouseenter', () => logo.src = 'images/logohover.png');
    logo.addEventListener('mouseleave', () => logo.src = 'images/testje.png');

  </script>
</body>

</html>