<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Display a map</title>
  <link rel="manifest" href="/KOVA/manifest.json">
  <meta name="theme-color" content="#000000">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="/KOVA/images/appicon.JPG">
  <script src="https://cdn.maptiler.com/maptiler-sdk-js/v3.2.0/maptiler-sdk.umd.min.js"></script>
  <link href="https://cdn.maptiler.com/maptiler-sdk-js/v3.2.0/maptiler-sdk.css" rel="stylesheet" />

  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
    }

    .marker-clickable {
      cursor: pointer !important;
    }


    #map {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 100%;
      z-index: 0;
    }

    .navbar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 60px;
      display: flex;
      align-items: flex-start;
      padding: 0 20px;
      background-color: rgba(0, 0, 0, 0);
      z-index: 10;
    }

    .navbar-left {
      display: flex;
      align-items: flex-start;
      gap: 30px;
    }

    .logo-time {
      display: flex;
      flex-direction: column;
      /* logo boven, tijd onder */
      align-items: flex-start;
      margin-top: 10px;
    }

    .navbar-logo {
      width: 140px;
      height: auto;
    }

    #time-info {
      margin-top: 4px;
      font-size: 12px;
      color: white;
      text-shadow: 0 0 4px black;
      line-height: 1.2;
    }

    .navbar-items {
      display: flex;
      gap: 20px;
      align-items: center;
    }

    .navbar-items a {
      color: white;
      text-decoration: none;
      font-weight: 500;
      font-size: 16px;
      line-height: 60px;
      cursor: pointer;
      transition: color 0.3s ease;
    }

    .navbar-items a:hover {
      color: #8b7108;
    }

    .maplibregl-popup-content {
      background-color: #000 !important;
      color: white !important;
      padding: 0 !important;
    }

    /* hide MapTiler watermark */
    .maplibregl-ctrl-bottom-left,
    .maplibregl-ctrl-logo,
    .maplibregl-ctrl-attrib,
    .maptiler-attribution {
      display: none !important;
      visibility: hidden !important;
      opacity: 0 !important;
    }

    .spot-marker {
      width: 20px;
      height: 20px;
      background-color: #8b7108;
      border: 2px solid black;
      border-radius: 50%;
      box-shadow: 0 0 4px rgba(0, 0, 0, 0.5);
      cursor: pointer;
      transform: translate(-50%, -50%);
    }

    .maplibregl-popup-close-button {
      color: red !important;
      background: transparent !important;
      font-size: 18px;
    }
  </style>
</head>

<body>
  <div class="navbar">
    <div class="navbar-left">
      <div class="logo-time">
        <img src="images/testje.png" alt="Logo" class="navbar-logo" id="mainLogo" />
        <div id="time-info"><span id="time-text">Ladenâ€¦</span></div>
      </div>
      <div class="navbar-items">
        <a href="radar.html" id="wxButton">WX</a>
        <a href="radar+wind.html" id="sfButton">SF</a>
        <a href="about.html" id="aboutButton">ABOUT</a>
      </div>
    </div>
  </div>

  <div id="map"></div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      maptilersdk.config.apiKey = "7TBqy4hTdFfQeIq7oXKj";

      const map = new maptilersdk.Map({
        container: "map",
        style: "https://api.maptiler.com/maps/dataviz-dark/style.json?key=7TBqy4hTdFfQeIq7oXKj",
        center: [4.5, 50.85],
        zoom: 7.5,
        minZoom: 5,
        navigationControl: false,
        projectionControl: false,
        geolocateControl: false
      });

      // GEOLOCATIE
      if (navigator.geolocation) {
        const userMarkerEl = document.createElement("img");
        userMarkerEl.src = "images/playericon.png";
        userMarkerEl.style.width = "28px";
        userMarkerEl.style.height = "28px";
        userMarkerEl.style.transform = "translate(-50%, -50%)";
        userMarkerEl.classList.add("marker-clickable");


        const userPopupHTML = `
          <div style="width:150px; text-align:center; font-family:sans-serif;">
            <img src="images/playeravatar.png" style="width:100%; height:auto; border-radius:6px; margin-bottom:6px;">
            <strong>This is you</strong><br>
          </div>
        `;
        const userPopup = new maptilersdk.Popup({ offset: 25 }).setHTML(userPopupHTML);

        const userMarker = new maptilersdk.Marker({ element: userMarkerEl })
          .setLngLat([0, 0])
          .setPopup(userPopup)
          .addTo(map);

        navigator.geolocation.getCurrentPosition(
          (position) => {
            const lng = position.coords.longitude;
            const lat = position.coords.latitude;
            userMarker.setLngLat([lng, lat]);
            map.setCenter([lng, lat]);
          },
          (err) => console.warn("Locatie fout:", err.message),
          { enableHighAccuracy: true }
        );
      }

      // SPOTS MET FOTO EN RATING
      const spots = [
        { name: "Test", desc: "first spot test", lng: 3.1211, lat: 50.9480, img: "images/appicon.JPG", rating: 6.4 },
        // { name: "De Visserij Ruiselede", desc: "kanker chill bankje aan het water", lng: 3.375637, lat: 51.078863, img: "spots/visserijspot.jpg", rating: 8.2 },
        // { name: "Poeke Kasteel", desc: "kanker chill bankje aan kasteel", lng: 3.449757, lat: 51.042137, img: "spots/poekekasteelspot.jpg", rating: 7.8 }
      ];

      spots.forEach(spot => {
        const el = document.createElement("div");
        el.className = "spot-marker";

        const popupHTML = `
          <div style="width:150px; text-align:center; font-family:sans-serif;">
            <img src="${spot.img}" style="width:100%; height:auto; border-radius:6px; margin-bottom:6px;">
            <strong>${spot.name}</strong><br>
            Description: ${spot.desc}<br>
            Rating: ${spot.rating}/10
          </div>
        `;

        const popup = new maptilersdk.Popup({ offset: 25 }).setHTML(popupHTML);

        new maptilersdk.Marker({ element: el })
          .setLngLat([spot.lng, spot.lat])
          .setPopup(popup)
          .addTo(map);
      });
    });

    // Live tijd functie
    function updateTime() {
      const now = new Date();
      const timeText = document.getElementById("time-text"); // alleen span
      if (timeText) {
        timeText.innerText = now.toLocaleString("nl-BE", {
          day: "2-digit", month: "2-digit", year: "numeric",
          hour: "2-digit", minute: "2-digit", second: "2-digit"
        });
      }
    }
    setInterval(updateTime, 1000);
    updateTime();
  </script>

  <script>
    // Logo hover swap
    const logo = document.getElementById("mainLogo");
    if (logo) {
      logo.addEventListener("mouseenter", () => {
        logo.src = "images/logohover.png";
      });
      logo.addEventListener("mouseleave", () => {
        logo.src = "images/testje.png";
      });
    }
  </script>
</body>

</html>